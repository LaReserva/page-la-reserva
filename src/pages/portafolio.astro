---
// src/pages/portafolio.astro
export const prerender = true;
import PageLayout from '@/layouts/PageLayout.astro';
import { HeroServices } from '@/components/sections/HeroServices';
import { PortfolioGrid } from '@/components/sections/PortfolioGrid';
import { supabase } from '@/lib/supabase';
import type { EventImageWithEvent } from '@/types';

// --- CARGA DE DATOS REALES (Server Side) ---

const { data, error } = await supabase
  .from('event_images')
  .select(`
    *,
    event:events (
      id,
      event_type,
      event_date,
      status
    )
  `)
  .eq('is_public', true) // ✅ 1. Solo mostramos las que marcaste como visibles en Admin
  .order('created_at', { ascending: false }); // ✅ 2. Las más recientes primero

if (error) {
  console.error("Error crítico cargando portafolio:", error);
}

// Transformamos los datos (si data es null, usamos array vacío)
const images = (data || []) as EventImageWithEvent[];
---

<PageLayout 
  title="Portafolio"
  description="Galería de eventos exclusivos realizados por La Reserva. Bodas, eventos corporativos y celebraciones privadas en Lima."
>
  
  {/* 1. HERO */}
  <HeroServices
    client:load
    title="Nuestra Galería"
    subtitle="Una colección de momentos memorables y cócteles excepcionales creados para nuestros clientes."
    imageDesktop="/images/portfolio-hero-desktop.png"
    imageTablet="/images/portfolio-hero-tablet.png"
    imageMobile="/images/portfolio-hero-mobile.png"
  />

  {/* 2. GRID PRINCIPAL */}
  <section class="section bg-secondary-50 min-h-screen">
    <div class="container-custom">
      
      <div class="text-center max-w-3xl mx-auto mb-16">
        <h2 class="text-3xl md:text-4xl font-display font-bold text-secondary-900 mb-4">
          Momentos Capturados
        </h2>
        <p class="text-lg text-secondary-500">
          Explora nuestros eventos recientes y encuentra inspiración para tu próxima celebración.
        </p>
      </div>

      {/* El componente React recibe 'images' con datos reales.
          - Si la foto tiene evento vinculado, aparecerá en su categoría (ej: 'Boda').
          - Si NO tiene evento vinculado, PortfolioGrid la clasificará automáticamente como 'Otros'.
      */}
      <PortfolioGrid client:load images={images} />
      
    </div>
  </section>

</PageLayout>