---
// src/pages/admin/login.astro

// ✅ 1. Arquitectura Rápida: Renderizado Estático
export const prerender = true;

import BaseLayout from '@/layouts/BaseLayout.astro';
import { LoginForm } from '@/components/admin/login/LoginForm';
---

<BaseLayout title="Login Admin | La Reserva" noindex={true}>
  <div class="min-h-screen flex flex-col items-center justify-center bg-secondary-50 px-4 relative overflow-hidden">
    
    {/* Fondo decorativo sutil */}
    <div class="absolute inset-0 pointer-events-none">
      <div class="absolute -top-24 -left-24 w-96 h-96 bg-primary-500/10 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-24 -right-24 w-96 h-96 bg-secondary-900/5 rounded-full blur-3xl"></div>
    </div>

    {/* Logo */}
    <div class="mb-8 relative z-10">
      <img src="/logo.svg" alt="La Reserva" class="h-16 w-auto" />
    </div>

    {/* Formulario */}
    <div class="w-full max-w-md relative z-10">
      {/* Usamos client:only para evitar hidratación innecesaria en el form */}
      <LoginForm client:only="react" />
    </div>

  </div>
  
  <script>
    import { supabase } from '@/lib/supabase';

    async function checkSession() {
      const { data: { session } } = await supabase.auth.getSession();
      
      // Si YA está logueado, lo sacamos de aquí
      if (session) {
        // 1. Buscamos si tenía una página pendiente (ej: intentó entrar a /admin/cotizaciones)
        const returnUrl = sessionStorage.getItem('redirect_to');
        
        if (returnUrl) {
            // Limpiamos la memoria y redirigimos a donde quería ir
            sessionStorage.removeItem('redirect_to');
            window.location.href = returnUrl;
        } else {
            // Si no, al dashboard general
            window.location.href = '/admin';
        }
      }
    }
    
    checkSession();
  </script>
</BaseLayout>