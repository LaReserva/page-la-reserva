---
// src/components/admin/AdminSidebar.astro
import { 
  LayoutDashboard, 
  MessageSquare, 
  CalendarDays, 
  Users, 
  Settings, 
  LogOut,
  Image as ImageIcon 
} from 'lucide-react';

const currentPath = Astro.url.pathname;

const menuItems = [
  { name: 'Dashboard', href: '/admin', icon: LayoutDashboard },
  { name: 'Cotizaciones', href: '/admin/cotizaciones', icon: MessageSquare },
  { name: 'Eventos', href: '/admin/eventos', icon: CalendarDays },
  { name: 'Clientes', href: '/admin/clientes', icon: Users },
  { name: 'Portafolio', href: '/admin/contenido', icon: ImageIcon },
  { name: 'Configuración', href: '/admin/configuracion', icon: Settings },
];

function isActive(href: string) {
  if (href === '/admin') return currentPath === '/admin';
  return currentPath.startsWith(href);
}
---

{/* CORRECCIÓN: Eliminamos 'flex' redundante, usamos 'hidden lg:flex' */}
<aside class="w-64 bg-secondary-900 text-white hidden lg:flex flex-col h-screen sticky top-0 border-r border-secondary-800">
  
  <div class="p-6 flex items-center justify-center border-b border-secondary-800">
    <img src="/logo.svg" alt="La Reserva Admin" class="h-8 w-auto brightness-0 invert" />
  </div>

  <nav class="flex-1 overflow-y-auto py-6 px-4">
    <ul class="space-y-2">
      {menuItems.map((item) => (
        <li>
          <a 
            href={item.href}
            class:list={[
              "flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 group",
              isActive(item.href) 
                ? "bg-primary-500 text-secondary-900 font-bold shadow-md" 
                : "text-secondary-300 hover:bg-secondary-800 hover:text-white"
            ]}
          >
            <item.icon 
              className={`w-5 h-5 ${isActive(item.href) ? 'text-secondary-900' : 'text-secondary-400 group-hover:text-white'}`} 
            />
            <span>{item.name}</span>
          </a>
        </li>
      ))}
    </ul>
  </nav>

  <div class="p-4 border-t border-secondary-800">
    <button 
      id="sidebar-logout-btn"
      class="flex items-center gap-3 px-4 py-3 w-full rounded-lg text-red-400 hover:bg-red-900/20 hover:text-red-300 transition-colors"
    >
      <LogOut className="w-5 h-5" />
      <span>Cerrar Sesión</span>
    </button>
  </div>
</aside>

<script>
  import { supabase } from '@/lib/supabase';

  const logoutBtn = document.getElementById('sidebar-logout-btn');
  
  logoutBtn?.addEventListener('click', async () => {
    await supabase.auth.signOut();
    window.location.href = '/admin/login';
  });
</script>