---
// src/components/sections/Services.astro
import ServiceCard from './ServiceCard.astro';
import Button from '@/components/ui/Button.astro';
import { supabase } from '@/lib/supabase'; // ✅ Importamos Supabase
import type { Service } from '@/types';

interface Props {
  className?: string;
}

const { className } = Astro.props;

// 1. Fetch de Servicios desde la BD
const { data: servicesData } = await supabase
  .from('services')
  .select('*')
  .eq('active', true)
  .order('order_index');

// 2. Casteo de tipos
const services = (servicesData || []) as unknown as Service[];
---

<section id="servicios" class:list={["relative py-20 md:py-32 bg-secondary-50 overflow-hidden", className]}>
  
  {/* Decoración de fondo sutil */}
  <div class="absolute top-0 left-0 w-full h-full opacity-[0.03] pointer-events-none">
    <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
      <path d="M0 100 C 20 0 50 0 100 100 Z" fill="currentColor" />
    </svg>
  </div>

  <div class="container mx-auto px-4 relative z-10">
    
    <div class="text-center max-w-3xl mx-auto mb-16 md:mb-20">
      <span class="text-primary-600 font-bold tracking-widest uppercase text-sm mb-2 block">
        Experiencias a Medida
      </span>
      <h2 class="text-4xl md:text-5xl font-display font-bold text-secondary-900 mb-6">
        Nuestros Servicios Exclusivos
      </h2>
      <p class="text-lg text-secondary-600 leading-relaxed">
        Elevamos el estándar de tu evento con mixología de autor, ingredientes premium y un servicio impecable diseñado para impresionar.
      </p>
    </div>

    {/* Grid de Servicios */}
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 lg:gap-8">
      {services.map((service) => (
        // ✅ Ahora pasamos el objeto directo, ya que viene de la BD con el formato correcto
        <ServiceCard service={service} />
      ))}
    </div>

    <div class="mt-16 text-center">
      <Button href="/servicios" variant="outline" class="border-secondary-300 text-secondary-600 hover:border-primary-500 hover:text-primary-600">
        Ver detalles completos
      </Button>
    </div>

  </div>
</section>